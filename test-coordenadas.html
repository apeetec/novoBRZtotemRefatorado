<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testador de Coordenadas - Mapa Brasil</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2196F3;
            text-align: center;
            margin-bottom: 30px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #2196F3;
        }
        button {
            background: #2196F3;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
        }
        button:hover {
            background: #1976D2;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        .info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
        .code {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .loading {
            text-align: center;
            color: #666;
        }
        .cities-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            background: #fafafa;
        }
        .city-item {
            padding: 5px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è Testador de Coordenadas - Mapa Brasil</h1>
        
        <div class="input-group">
            <label for="cidade">Nome da Cidade:</label>
            <input type="text" id="cidade" placeholder="Ex: S√£o Paulo, Campinas, Salvador..." />
        </div>
        
        <div class="input-group">
            <label for="metodo">M√©todo de Busca:</label>
            <select id="metodo">
                <option value="local">Coordenadas Fixas (Local)</option>
                <option value="proxy">Proxy PHP</option>
                <option value="ambos">Ambos (Prefer√™ncia Local)</option>
            </select>
        </div>
        
        <button onclick="testarCoordenadas()">üîç Buscar Coordenadas</button>
        
        <div id="resultado" class="result"></div>
        
        <div style="margin-top: 30px;">
            <h3>üìã Cidades Dispon√≠veis Localmente</h3>
            <p>Clique em uma cidade para testar:</p>
            <div id="cidadesDisponiveis" class="cities-list"></div>
        </div>
    </div>

    <script>
        // Base de coordenadas fixas (mesma do sistema principal)
        const coordenadasCidades = {
            // S√£o Paulo
            'Campinas': [-47.0608, -22.9056],
            'S√£o Paulo': [-46.6333, -23.5505],
            'Santos': [-46.3336, -23.9618],
            'S√£o Jos√© dos Campos': [-45.8867, -23.2237],
            'Sorocaba': [-47.4581, -23.5015],
            'Ribeir√£o Preto': [-47.8103, -21.1767],
            'S√£o Bernardo do Campo': [-46.5653, -23.6914],
            'Guarulhos': [-46.5333, -23.4628],
            'Osasco': [-46.7917, -23.5329],
            'Bauru': [-49.0847, -22.3147],
            'Hortol√¢ndia': [-47.2200, -22.8583],
            
            // Rio de Janeiro
            'Rio de Janeiro': [-43.1729, -22.9068],
            'Niter√≥i': [-43.1036, -22.8833],
            'Nova Igua√ßu': [-43.4514, -22.7592],
            'Duque de Caxias': [-43.3117, -22.7856],
            'S√£o Gon√ßalo': [-43.0539, -22.8267],
            'S√£o Pedro da Aldeia': [-42.1011, -22.8408],
            
            // Bahia
            'Salvador': [-38.5014, -12.9714],
            'Feira de Santana': [-38.9667, -12.2667],
            'Vit√≥ria da Conquista': [-40.8394, -14.8619],
            'Cama√ßari': [-38.3236, -12.6997],
            
            // Outros estados
            'Bras√≠lia': [-47.8825, -15.7942],
            'Belo Horizonte': [-43.9378, -19.9208],
            'Fortaleza': [-38.5267, -3.7319],
            'Curitiba': [-49.2731, -25.4284],
            'Porto Alegre': [-51.2197, -30.0346],
            'Recife': [-34.8817, -8.0476],
            'Manaus': [-60.0261, -3.1190],
            'Bel√©m': [-48.5044, -1.4558]
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarCidadesDisponiveis();
        });

        function carregarCidadesDisponiveis() {
            const container = document.getElementById('cidadesDisponiveis');
            const cidades = Object.keys(coordenadasCidades).sort();
            
            container.innerHTML = cidades.map(cidade => 
                `<div class="city-item" onclick="selecionarCidade('${cidade}')" style="cursor: pointer;">
                    üìç ${cidade}
                </div>`
            ).join('');
        }

        function selecionarCidade(cidade) {
            document.getElementById('cidade').value = cidade;
            testarCoordenadas();
        }

        async function testarCoordenadas() {
            const cidade = document.getElementById('cidade').value.trim();
            const metodo = document.getElementById('metodo').value;
            const resultado = document.getElementById('resultado');
            
            if (!cidade) {
                mostrarResultado('error', 'Por favor, digite o nome de uma cidade.');
                return;
            }
            
            resultado.style.display = 'block';
            resultado.className = 'result info';
            resultado.innerHTML = '<div class="loading">üîç Buscando coordenadas...</div>';
            
            try {
                let coordenadas = null;
                let fonte = '';
                
                if (metodo === 'local' || metodo === 'ambos') {
                    coordenadas = buscarCoordenadasLocais(cidade);
                    if (coordenadas) {
                        fonte = 'Coordenadas Fixas (Local)';
                    }
                }
                
                if (!coordenadas && (metodo === 'proxy' || metodo === 'ambos')) {
                    coordenadas = await buscarCoordenadasProxy(cidade);
                    if (coordenadas) {
                        fonte = 'Proxy PHP';
                    }
                }
                
                if (coordenadas) {
                    const codigo = `'${cidade}': [${coordenadas[0]}, ${coordenadas[1]}],`;
                    
                    mostrarResultado('success', `
                        ‚úÖ <strong>Coordenadas encontradas!</strong><br>
                        <strong>Cidade:</strong> ${cidade}<br>
                        <strong>Fonte:</strong> ${fonte}<br>
                        <strong>Longitude:</strong> ${coordenadas[0]}<br>
                        <strong>Latitude:</strong> ${coordenadas[1]}<br>
                        <strong>Para adicionar ao c√≥digo:</strong>
                        <div class="code">${codigo}</div>
                    `);
                } else {
                    mostrarResultado('error', `
                        ‚ùå <strong>Coordenadas n√£o encontradas</strong><br>
                        Cidade: ${cidade}<br><br>
                        <strong>Como adicionar manualmente:</strong><br>
                        1. Encontre as coordenadas em: <a href="https://www.google.com/maps" target="_blank">Google Maps</a><br>
                        2. Adicione no c√≥digo:<br>
                        <div class="code">'${cidade}': [longitude, latitude],</div>
                    `);
                }
                
            } catch (error) {
                mostrarResultado('error', `
                    ‚ùå <strong>Erro ao buscar coordenadas:</strong><br>
                    ${error.message}
                `);
            }
        }

        function buscarCoordenadasLocais(cidade) {
            // Busca exata
            if (coordenadasCidades[cidade]) {
                return coordenadasCidades[cidade];
            }
            
            // Busca por similaridade
            const cidadeNorm = normalizarNome(cidade);
            for (const [nome, coords] of Object.entries(coordenadasCidades)) {
                const nomeNorm = normalizarNome(nome);
                if (nomeNorm === cidadeNorm || 
                    nomeNorm.includes(cidadeNorm) || 
                    cidadeNorm.includes(nomeNorm)) {
                    return coords;
                }
            }
            
            return null;
        }

        async function buscarCoordenadasProxy(cidade) {
            try {
                const proxyUrl = `geocoding-proxy.php?cidade=${encodeURIComponent(cidade)}`;
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.coordenadas) {
                    return data.coordenadas;
                }
                
                return null;
            } catch (error) {
                console.error('Erro no proxy:', error);
                return null;
            }
        }

        function normalizarNome(nome) {
            return nome
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .toLowerCase()
                .trim();
        }

        function mostrarResultado(tipo, mensagem) {
            const resultado = document.getElementById('resultado');
            resultado.style.display = 'block';
            resultado.className = `result ${tipo}`;
            resultado.innerHTML = mensagem;
        }
    </script>
</body>
</html>